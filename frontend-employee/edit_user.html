<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>แก้ไขสมาชิก | ระบบจัดการงานซ่อม</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    body{
      font-family:'Kanit',sans-serif;
      background:#f4f7f9;
      margin:0;
      padding:40px;
    }

    .card{
      max-width:500px;
      margin:auto;
      background:#fff;
      padding:30px;
      border-radius:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.15);
    }

    h2{
      margin-top:0;
      color:#2c3e50;
      text-align:center;
    }

    label{
      font-weight:600;
      margin-top:14px;
      display:block;
    }

    input, select{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #d1d5db;
      font-family:'Kanit',sans-serif;
      margin-top:6px;
    }

    .actions{
      margin-top:30px;
      display:flex;
      gap:10px;
    }

    button{
      flex:1;
      padding:12px;
      border-radius:999px;
      border:none;
      font-weight:600;
      cursor:pointer;
    }

    .btn-save{
      background:#1abc9c;
      color:#fff;
    }

    .btn-cancel{
      background:#e5e7eb;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>✏️ แก้ไขข้อมูลสมาชิก</h2>

  <label>ชื่อ</label>
  <input id="firstName">

  <label>นามสกุล</label>
  <input id="lastName">

  <label>อีเมล (แก้ไม่ได้)</label>
  <input id="email" disabled>

  <label>เบอร์โทร</label>
  <input id="phone">

  <label>บทบาท</label>
  <select id="role">
    <option value="admin">ผู้ดูแลระบบ</option>
    <option value="staff">พนักงาน</option>
    <option value="tech">ช่าง</option>
  </select>

  <label>สถานะ</label>
  <select id="active">
    <option value="true">ใช้งาน</option>
    <option value="false">ปิดใช้งาน</option>
  </select>

  <div class="actions">
    <button class="btn-cancel" onclick="history.back()">ยกเลิก</button>
    <button class="btn-save" onclick="saveUser()">บันทึก</button>
  </div>
</div>

<script>
const API = "/api";
const token = localStorage.getItem("token");
const params = new URLSearchParams(location.search);
const userId = params.get("id");

if(!token || !userId){
  alert("ไม่พบข้อมูลผู้ใช้");
  location.href = "admin_dashboard.html";
}

/* ========================
   LOAD USER
======================== */
async function loadUser(){
  const res = await fetch(`${API}/employees/${userId}/profile`,{
    headers:{ Authorization:`Bearer ${token}` }
  });
  const user = await res.json();

  document.getElementById("firstName").value = user.firstName;
  document.getElementById("lastName").value  = user.lastName;
  document.getElementById("email").value     = user.email || "-";
  document.getElementById("phone").value     = user.phone || "";
  document.getElementById("role").value      = user.role;
  document.getElementById("active").value    = user.active ? "true" : "false";
}

/* ========================
   SAVE USER
======================== */
async function saveUser(){
  const body = {
    firstName: firstName.value.trim(),
    lastName : lastName.value.trim(),
    phone    : phone.value.trim(),
    role     : role.value,
    active   : active.value === "true"
  };

  const res = await fetch(`${API}/employees/${userId}`,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      Authorization:`Bearer ${token}`
    },
    body:JSON.stringify(body)
  });

  const data = await res.json();

  if(!res.ok){
    alert(data.message || "บันทึกไม่สำเร็จ");
    return;
  }

  alert("✅ บันทึกข้อมูลเรียบร้อย");
  location.href = "admin_dashboard.html";
}

loadUser();
</script>

</body>
</html>
