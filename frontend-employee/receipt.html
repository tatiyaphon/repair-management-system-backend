<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ใบรับเครื่องซ่อม - ร้านตุ้ยไอที โคราช</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap');

@page { size: A4; margin: 18mm; }

body{
  font-family:'Sarabun',sans-serif;
  background:#eef2f7;
  margin:0;
  padding:20px;
}

.container{
  width:210mm;
  margin:auto;
  background:#fff;
  padding:40px;
  border-radius:10px;
}

/* ===== HEADER ===== */
header{
  display:flex;
  justify-content:space-between;
  border-bottom:3px solid #f6c200;
  padding-bottom:15px;
}

.shop h1{margin:0;color:#0f3c8a}
.shop p{margin:4px 0;font-size:14px}

.doc{text-align:right}
.doc h2{margin:0;color:#0f3c8a}
.no{color:#b91c1c;font-weight:bold}

/* ===== INFO ===== */
.info{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:20px;
  margin-top:20px;
}

.box{
  border:1px solid #d1d5db;
  padding:15px;
  border-radius:8px;
}

.box h3{
  margin:0 0 10px;
  color:#0f3c8a;
  border-bottom:1px solid #d1d5db;
}

.row{
  display:flex;
  margin-bottom:6px;
}
.label{
  width:110px;
  font-weight:600;
}

.badge{
  display:inline-block;
  padding:4px 12px;
  border-radius:999px;
  background:#ecfdf5;
  color:#047857;
  border:1px solid #10b981;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}
th,td{
  border-bottom:1px solid #d1d5db;
  padding:10px;
}

/* ===== SIGN ===== */
.sign{
  margin-top:60px;
  display:grid;
  grid-template-columns:1fr 1fr;
  text-align:center;
}
.line{
  border-top:1px solid #000;
  margin-top:40px;
  padding-top:6px;
}
</style>
</head>

<body>

<div class="container">

<header>
  <div class="shop">
    <h1>ร้านตุ้ยไอที โคราช</h1>
    <p>ศูนย์ซ่อมและจำหน่ายอุปกรณ์ไอที</p>
    <p>โทร 080-4641677</p>
  </div>

  <div class="doc">
    <h2>ใบรับเครื่องซ่อม</h2>
    <div class="no">No. <span id="receiptNumber">-</span></div>
    <p>วันที่ <span id="receivedDate">-</span></p>
  </div>
</header>

<div class="info">
  <div class="box">
    <h3>ข้อมูลลูกค้า</h3>
    <div class="row"><div class="label">ชื่อ</div><div id="customerName">-</div></div>
    <div class="row"><div class="label">เบอร์</div><div id="customerPhone">-</div></div>
    <div class="row"><div class="label">ที่อยู่</div><div id="customerAddress">-</div></div>
  </div>

  <div class="box">
    <h3>สถานะงาน</h3>
    <span class="badge" id="jobStatus">-</span>
  </div>
</div>

<table>
<thead>
<tr>
  <th width="10%">ลำดับ</th>
  <th width="45%">อุปกรณ์</th>
  <th width="45%">อาการ</th>
</tr>
</thead>
<tbody>
<tr>
  <td>1</td>
  <td><strong id="deviceType">-</strong><br><small id="deviceModel">-</small></td>
  <td id="symptom">-</td>
</tr>
</tbody>
</table>

<div class="sign">
  <div>
    <div class="line">ผู้ส่งเครื่อง</div>
    (<span id="signCustomer">-</span>)
  </div>
  <div>
    <div class="line">ผู้รับเครื่อง</div>
    (ร้านตุ้ยไอที)
  </div>
</div>

</div>

<script>
(async () => {
  const params = new URLSearchParams(location.search);
  const jobId = params.get("id");

  if (!jobId) {
    document.body.innerHTML = "<h2>ไม่พบข้อมูลงาน</h2>";
    return;
  }

  try {
    const res = await fetch(`/api/jobs/${jobId}`);
    if (!res.ok) throw new Error("โหลดข้อมูลไม่สำเร็จ");

    const j = await res.json();

    receiptNumber.textContent = j.receiptNumber;
    receivedDate.textContent =
      new Date(j.receivedDate).toLocaleDateString("th-TH");

    customerName.textContent = j.customerName;
    customerPhone.textContent = j.customerPhone || "-";
    customerAddress.textContent = j.customerAddress || "-";

    jobStatus.textContent = j.status;

    deviceType.textContent = j.deviceType;
    deviceModel.textContent = j.deviceModel;
    symptom.textContent = j.symptom;

    signCustomer.textContent = j.customerName;

  } catch (e) {
    console.error(e);
    document.body.innerHTML = "<h2>โหลดข้อมูลไม่ได้</h2>";
  }
})();
</script>

</body>
</html>
