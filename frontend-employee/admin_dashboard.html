<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</title>
  <link rel="icon" type="image/png" href="logo1.png">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Font Awesome -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet">

  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #1abc9c;
      --accent-color: #3498db;
      --background-color: #f4f7f9;
      --card-background: #fff;
      --text-color: #2c3e50;
      --light-text-color: #95a5a6;
      --border-radius: 12px;
      --box-shadow: 0 8px 25px rgba(0, 0, 0, .08);

      --new-color: #3498db;
      --in_progress-color: #f39c12;
      --waiting_parts-color: #e74c3c;
      --completed-color: #2ecc71;

      --claim-color: #9b59b6;
      --new-repair-color: #2c3e50;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Kanit', sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      margin: 0;
      line-height: 1.6;
    }

    .container {
      max-width: 1300px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    /* Header */
    header {
      background: var(--primary-color);
      color: #fff;
      padding: 15px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, .15);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-links {
      margin-left: auto;   /* ‡∏î‡∏±‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏õ‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤ */
  display: flex;
  gap: 20px;
  align-items: center;
    }

    .nav-link {
      color: rgba(255, 255, 255, .7);
      text-decoration: none;
      font-weight: 500;
      transition: .3s;
      display: flex;
      align-items: center;
      padding-bottom: 4px;
    }

    .nav-link i { margin-right: 5px; }

    .nav-link:hover { color: #fff; }

    .nav-link.active {
      color: #fff;
      border-bottom: 3px solid var(--secondary-color);
    }

    .logout-btn {
      border: 1px solid var(--secondary-color);
      color: var(--secondary-color);
      background: #fff;
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 600;
      transition: .3s;
    }

    .logout-btn:hover {
      background: var(--secondary-color);
      color: #fff;
    }

    .user-meta {
      font-size: .9rem;
      color: rgba(255, 255, 255, .8);
      margin-left: 20px;
    }

    /* Dashboard header */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 25px;
    }

    .page-title {
      margin: 0;
      font-size: 1.9rem;
      font-weight: 700;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-subtitle {
      margin: 4px 0 0;
      font-size: .95rem;
      color: var(--light-text-color);
    }

    .tag-admin {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(26, 188, 156, .08);
      color: var(--secondary-color);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: .85rem;
      font-weight: 600;
    }

    /* Cards */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .card {
      background: var(--card-background);
      border-radius: var(--border-radius);
      padding: 20px 22px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, .06);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: .25s;
      border-left: 5px solid;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, .12);
    }

    .card-content {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .card-title {
      font-size: .9rem;
      color: var(--light-text-color);
      font-weight: 500;
      margin: 0;
    }

    .card-number {
      font-size: 2.4rem;
      font-weight: 700;
      margin: 0;
    }

    .card-note {
      font-size: .8rem;
      color: var(--light-text-color);
    }

    .card-icon {
      font-size: 2.5rem;
      opacity: .2;
    }

    .card-total      { border-left-color: var(--primary-color); }
    .card-new        { border-left-color: var(--new-color); }
    .card-progress   { border-left-color: var(--in_progress-color); }
    .card-completed  { border-left-color: var(--completed-color); }
    .card-users      { border-left-color: var(--accent-color); }

    .card-total .card-number     { color: var(--primary-color); }
    .card-new .card-number       { color: var(--new-color); }
    .card-progress .card-number  { color: var(--in_progress-color); }
    .card-completed .card-number { color: var(--completed-color); }
    .card-users .card-number     { color: var(--accent-color); }

    /* Layout: 2 panels */
    .grid-2col {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 25px;
      align-items: flex-start;
    }

    .panel {
      background: var(--card-background);
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: var(--box-shadow);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .panel-title {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-subtitle {
      margin: 0;
      font-size: .85rem;
      color: var(--light-text-color);
    }

    .badge-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: .8rem;
      background: #ecf0f1;
      color: var(--text-color);
    }

    .badge-pill i { font-size: .8rem; }

    /* Table */
    .table-wrapper {
      overflow-x: auto;
    }

    .styled-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      font-size: .9rem;
    }

    .styled-table thead tr {
      background: var(--primary-color);
      color: #fff;
    }

    .styled-table th,
    .styled-table td {
      padding: 10px 12px;
      vertical-align: middle;
    }

    .styled-table tbody tr {
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .04);
      transition: .2s;
    }

    .styled-table tbody tr:hover {
      background: #fcfdfe;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, .08);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      color: #fff;
      font-weight: 600;
      font-size: .75rem;
      min-width: 90px;
      text-align: center;
    }

    .status-new          { background: var(--new-color); }
    .status-in_progress  { background: var(--in_progress-color); }
    .status-waiting_parts{ background: var(--waiting_parts-color); }
    .status-completed    { background: var(--completed-color); }

    .role-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: .75rem;
      font-weight: 600;
    }

    .role-admin   { background: rgba(231, 76, 60, .12); color: #e74c3c; }
    .role-tech    { background: rgba(52, 152, 219, .12); color: #2980b9; }
    .role-staff   { background: rgba(46, 204, 113, .12); color: #27ae60; }

    .role-select {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #dcdde1;
      font-family: 'Kanit', sans-serif;
      font-size: .85rem;
      background: #fff;
    }

    .btn-small {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: .8rem;
      cursor: pointer;
      font-family: 'Kanit', sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: .2s;
    }

    .btn-save {
      background: var(--secondary-color);
      color: #fff;
    }
    .btn-save:hover {
      background: #16a085;
      transform: translateY(-1px);
    }

    .btn-delete {
      background: #ecf0f1;
      color: #e74c3c;
    }
    .btn-delete:hover {
      background: #e74c3c;
      color: #fff;
    }

    .empty-text {
      text-align: center;
      font-size: .9rem;
      color: var(--light-text-color);
      padding: 8px 0;
    }

    /* Add user form */
    .add-user-form {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
      align-items: center;
    }

    .add-user-form input,
    .add-user-form select {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #dcdde1;
      font-family: 'Kanit', sans-serif;
      font-size: .85rem;
    }

    .add-user-form input {
      flex: 1 1 120px;
      min-width: 0;
    }

    .btn-add-user {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: .8rem;
      cursor: pointer;
      font-family: 'Kanit', sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: var(--accent-color);
      color: #fff;
      white-space: nowrap;
    }

    .btn-add-user:hover {
      background: #2471a3;
      transform: translateY(-1px);
    }

    /* Logs panel */
    .logs-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .panel-filter-text {
      font-size: .85rem;
      color: var(--light-text-color);
    }

    .log-type-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      font-size: .7rem;
      padding: 3px 8px;
      color: #fff;
    }

    .log-user   { background: #8e44ad; }
    .log-job    { background: #2980b9; }
    .log-auth   { background: #16a085; }

    .logs-table td {
      font-size: .85rem;
    }

    @media (max-width: 992px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        padding: 15px 20px;
        gap: 8px;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: flex-start;
      }

      .user-meta { margin-left: 0; }

      .grid-2col {
        grid-template-columns: 1fr;
      }
    }

   @media (max-width: 576px) {
  .profile-dropdown {
    position: fixed;
    top: 64px;          /* ‡πÉ‡∏ï‡πâ header */
    left: 12px;
    right: 12px;
    width: auto;
    max-width: none;
    max-height: calc(100vh - 80px);
    overflow-y: auto;
    border-radius: 14px;
    z-index: 10000;
  }

      .panel {
        padding: 18px;
      }
    }
    /* ===== User Management UX ===== */

.add-user-card {
  background: #f9fbfc;
  border: 1px solid #e5e9f0;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 18px;
}

.add-user-card h3 {
  margin: 0 0 12px;
  font-size: 1rem;
  font-weight: 600;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  gap: 8px;
}

.add-user-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.add-user-grid input,
.add-user-grid select {
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #dcdde1;
  font-family: 'Kanit', sans-serif;
  font-size: .9rem;
}

.add-user-grid button {
  grid-column: 1 / -1;
  justify-self: flex-start;
}

.hint-text {
  margin-top: 8px;
  font-size: .8rem;
  color: var(--light-text-color);
}

/* Role badges */
.role-badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: .75rem;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
}

.role-admin {
  background: rgba(231, 76, 60, .15);
  color: #e74c3c;
}
.role-tech {
  background: rgba(52, 152, 219, .15);
  color: #2980b9;
}
.role-staff {
  background: rgba(46, 204, 113, .15);
  color: #27ae60;
}
.users-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
  }
  .profile-menu {
  position: relative;
  z-index: 99999;
}

.profile-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  background: #fff;
  color: #2c3e50;
  padding: 6px 14px;
  border-radius: 30px;
  font-weight: 600;
}

.profile-trigger img {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  object-fit: cover;
}

.profile-dropdown {
  position: absolute;
  right: 0;
  top: 120%;
  width: 260px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 15px 40px rgba(0,0,0,.15);
  display: none;
  z-index: 999;
}

.profile-dropdown.show { display: block; }

.profile-header {
  display: flex;
  gap: 12px;
  padding: 16px;
  border-bottom: 1px solid #eee;
}

.profile-header img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
}

.profile-item {
  padding: 12px 16px;
  display: flex;
  gap: 10px;
  align-items: center;
  background: none;
  border: none;
  width: 100%;
  cursor: pointer;
  text-decoration: none;
  color: #2c3e50;
  font-size: 14px;
}

.profile-item:hover { background: #f4f7f9; }

.profile-item.logout {
  color: #e74c3c;
  font-weight: 600;
}

.upload-btn input { display: none; }

.divider {
  height: 1px;
  background: #eee;
  margin: 6px 0;
}
.avatar-wrapper {
  position: relative;
}

.avatar-wrapper img {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
  cursor: pointer;
  border: 2px solid #1abc9c;
}

/* dropdown */
.avatar-menu {
  position: absolute;
  right: 0;
  top: 120%;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,.15);
  display: none;
  overflow: hidden;
  z-index: 1000;
  min-width: 120px;
}

.avatar-menu.show {
  display: block;
}

.avatar-item {
  padding: 10px 14px;
  font-size: 14px;
  cursor: pointer;
  white-space: nowrap;
}

.avatar-item:hover {
  background: #f4f7f9;
}

.avatar-item.logout {
  color: #e74c3c;
  font-weight: 600;
}
.profile-menu {
  position: relative;
}

.profile-trigger img {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
  cursor: pointer;
  border: 2px solid #1abc9c;
}

/* dropdown */
.profile-dropdown {
  position: absolute;
  right: 0;
  top: 120%;
  width: 260px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 12px 30px rgba(0,0,0,.15);
  display: none;
  z-index: 999;
}

.profile-dropdown.show {
  display: block;
}

/* header */
.profile-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px;
  border-bottom: 1px solid #e5e7eb;
}

.profile-header img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
}

/* menu item */
.profile-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  font-size: 14px;
  cursor: pointer;
  color: #2c3e50;
  text-decoration: none;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
}

.profile-item:hover {
  background: #f4f7f9;
}

.profile-item.logout {
  color: #e74c3c;
  font-weight: 600;
}

.divider {
  height: 1px;
  background: #e5e7eb;
  margin: 6px 0;
}
.status-active {
  color: #16a34a;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.status-dot {
  width: 8px;
  height: 8px;
  background: #16a34a;
  border-radius: 50%;
  display: inline-block;
}
/* ===== USERS TABLE ===== */
#admin-users-table {
  width: 100%;
  border-collapse: collapse;
}

#admin-users-table th {
  background: #2c3e50;
  color: #fff;
  padding: 12px;
  text-align: left;
  font-weight: 600;
}

#admin-users-table td {
  padding: 12px;
  border-bottom: 1px solid #e5e7eb;
  vertical-align: middle;
}

/* ===== SELECT (‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞) ===== */
#admin-users-table select {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-family: 'Kanit', sans-serif;
  background: #fff;
  cursor: pointer;
  transition: .2s;
}

#admin-users-table select:hover {
  border-color: #1abc9c;
}

#admin-users-table select:focus {
  outline: none;
  border-color: #1abc9c;
  box-shadow: 0 0 0 3px rgba(26,188,156,.25);
}

/* ===== STATUS COLOR ===== */
.status-active {
  color: #16a34a;
  font-weight: 600;
}

.status-inactive {
  color: #dc2626;
  font-weight: 600;
}

/* ===== DELETE BUTTON ===== */
.btn-delete {
  background: #fff;
  color: #dc2626;
  border: 1px solid #dc2626;
  padding: 6px 14px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  transition: .25s;
}

.btn-delete:hover {
  background: #dc2626;
  color: #fff;
}

/* ===== USER NAME ===== */
.user-name {
  font-weight: 600;
  color: #111827;
}

.user-email {
  color: #6b7280;
  font-size: 14px;
}
.role-select{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #d1d5db;
  font-family:'Kanit',sans-serif;
}

.status-active{
  color:#16a34a;
  font-weight:600;
}

.btn-delete{
  background:#ef4444;
  color:#fff;
  border:none;
  padding:5px 10px;
  border-radius:6px;
  cursor:pointer;
}
.btn-delete:hover{
  background:#dc2626;
}
.profile-menu{
  position: relative;
  z-index: 9999;
}

.profile-trigger img{
  width:42px;
  height:42px;
  border-radius:50%;
  border:2px solid #1abc9c;
  cursor:pointer;
  object-fit:cover;
}

.profile-dropdown{
  position:absolute;
  right:0;
  top:55px;
  width:220px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  display:none;
  z-index:10000;
}

.profile-dropdown.show{
  display:block;
}
.profile-menu{
  position: relative;
  z-index: 99999; /* ‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏ô element ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡∏ö */
}

.profile-trigger{
  cursor: pointer;
}

.profile-trigger img{
  pointer-events: auto;
}
/* ===== ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ===== */
#admin-users-table td.cell-center {
  text-align: center;
  vertical-align: middle;
}

/* ===== role select ===== */
.role-select {
  padding: 6px 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-family: 'Kanit', sans-serif;
  font-size: 14px;
  cursor: pointer;
}

/* ===== status badge ===== */
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 600;
  font-size: 14px;
}

.status-badge.online {
  color: #16a34a;
}

/* ===== delete button ===== */
.btn-delete {
  background: #ef4444;
  color: #fff;
  border: none;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  cursor: pointer;
  transition: 0.2s;
}

.btn-delete:hover {
  background: #dc2626;
}
/* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
.center {
  text-align: center;
  vertical-align: middle;
}

/* ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ */
.action-group {
  display: inline-flex;
  gap: 8px;
}

/* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç */
.btn-edit {
  background: #e5e7eb;
  color: #1f2937;
  border: 1px solid #d1d5db;
  padding: 5px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.btn-edit:hover {
  background: #d1d5db;
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö */
.btn-delete {
  background: #ef4444;
  color: #fff;
  border: none;
  padding: 5px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.btn-delete:hover {
  background: #dc2626;
}

/* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
.status-active {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(22,163,74,.12);
  color: #16a34a;
  padding: 4px 12px;
  border-radius: 999px;
  font-weight: 600;
}

.status-dot {
  width: 8px;
  height: 8px;
  background: #16a34a;
  border-radius: 50%;
}

/* dropdown ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó */
.role-select {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-family: 'Kanit', sans-serif;
}
.status-inactive {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(220,38,38,.12);
  color: #dc2626;
  padding: 4px 12px;
  border-radius: 999px;
  font-weight: 600;
}

.status-dot.offline {
  background: #dc2626;
}
.status-online {
  color: #16a34a;
  font-weight: 600;
}

.status-offline {
  color: #dc2626;
  font-weight: 600;
}

  </style>
</head>
<body>
  <header>
    <div class="logo">
      <i class="fas fa-tools"></i>
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°
    </div>
    <nav class="nav-links">
      <a href="employee_dashboard.html" class="nav-link">
        <i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
      </a>
      <a href="new_job.html" class="nav-link">
        <i class="fas fa-plus-circle"></i> ‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°
      </a>
      <a href="stock_management.html" class="nav-link">
        <i class="fas fa-box-open"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
      </a>
      <a href="technician_jobs.html" class="nav-link">
        <i class="fas fa-tools"></i> ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
      </a>
      <a href="reports.html" class="nav-link">
        <i class="fas fa-chart-line"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
      </a>
      <a href="admin_dashboard.html" id="adminTab">
        <i class="fas fa-user-shield"></i> ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
      </a>

<div class="profile-menu" id="profileMenu">
  <div class="profile-trigger" onclick="toggleProfile()">
    <!-- ‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) -->
    <img
  id="profileAvatar"
  src=""
  alt="avatar"
  style="width:42px;height:42px;border-radius:50%;object-fit:cover;"
>

  </div>

  <div class="profile-dropdown" id="profileDropdown">
    <div class="profile-header">
      <!-- ‚úÖ ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ô dropdown -->
      <img
  id="profileAvatarLarge"
  src=""
  alt="avatar-large"
  style="width:60px;height:60px;border-radius:50%;object-fit:cover;"
>

      <div>
        <strong id="profileNameLarge">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</strong><br>
        <small id="profileRole">‚Äî</small>
      </div>
    </div>

    <label class="profile-item upload-btn">
      <i class="fas fa-camera"></i> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
      <input type="file" accept="image/*" onchange="uploadAvatar(event)">
    </label>

    <a class="profile-item" href="profile.html">
      <i class="fas fa-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
    </a>

    <a class="profile-item" href="change_password.html">
      <i class="fas fa-lock"></i> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
    </a>

    <a class="profile-item" href="repair_history.html">
      <i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°
    </a>

    <div class="divider"></div>

    <button class="profile-item logout" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </button>
  </div>
</div>

    </nav>
    <div class="user-meta" id="user-meta">-</div>
  </header>

  <main class="container">
    <div class="page-header">
      <div>
        <h1 class="page-title">
          <i class="fas fa-user-shield"></i> ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
        </h1>
        <p class="page-subtitle">
          ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        </p>
      </div>
      <div class="tag-admin">
        <i class="fas fa-lock"></i>
        ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
      </div>
    </div>

    <!-- Cards summary -->
    <section class="dashboard-grid">
      <div class="card card-total">
        <div class="card-content">
          <p class="card-title">‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          <p class="card-number" id="card-total-jobs">0</p>
          <p class="card-note" id="card-total-note">-</p>
        </div>
        <i class="fas fa-clipboard-list card-icon"></i>
      </div>

      <div class="card card-new">
        <div class="card-content">
          <p class="card-title">‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</p>
          <p class="card-number" id="card-new-jobs">0</p>
          <p class="card-note">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ / ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
        </div>
        <i class="fas fa-plus-square card-icon"></i>
      </div>

      <div class="card card-progress">
        <div class="card-content">
          <p class="card-title">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ / ‡∏£‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</p>
          <p class="card-number" id="card-progress-jobs">0</p>
          <p class="card-note">‡∏î‡∏π‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
        </div>
        <i class="fas fa-wrench card-icon"></i>
      </div>

      <div class="card card-completed">
        <div class="card-content">
          <p class="card-title">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
          <p class="card-number" id="card-completed-jobs">0</p>
          <p class="card-note">‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
        </div>
        <i class="fas fa-check-circle card-icon"></i>
      </div>

      <div class="card card-users">
        <div class="card-content">
          <p class="card-title">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
          <p class="card-number" id="card-users-count">0</p>
          <p class="card-note" id="card-users-note">-</p>
        </div>
        <i class="fas fa-users-cog card-icon"></i>
      </div>
    </section>

    <!-- 2 panels: jobs + users -->
    <section class="grid-2col">
      <!-- Jobs panel -->
      <div class="panel">
        <div class="panel-header">
          <div>
            <h2 class="panel-title">
              <i class="fas fa-clipboard-list"></i> ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            </h2>
            <p class="panel-subtitle">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° 10 ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
          </div>
          <span class="badge-pill">
            <i class="fas fa-info-circle"></i>
            ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å mockJobs (localStorage)
          </span>
        </div>
        <div class="table-wrapper">
          <table class="styled-table" id="admin-jobs-table">
            <thead>
              <tr>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏á‡∏≤‡∏ô</th>
                <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</th>
              </tr>
            </thead>
            <tbody>
              <!-- JS ‡πÄ‡∏ï‡∏¥‡∏° -->
            </tbody>
          </table>
        </div>
        <div id="jobs-empty" class="empty-text" style="display:none;">
          <i class="fas fa-box-open"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        </div>
      </div>

      <!-- Users panel -->
     <div class="panel">
  <div class="panel-header">
    <div>
      <h2 class="panel-title">
        <i class="fas fa-users-cog"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      </h2>
      <p class="panel-subtitle">
        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô / ‡∏ä‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
      </p>
    </div>
  </div>


  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
  <div class="panel">
  <div class="panel-header">
    <div>
      <h2 class="panel-title">
        <i class="fas fa-users-cog"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      </h2>
      <p class="panel-subtitle">
        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô / ‡∏ä‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
      </p>
    </div>
  </div>

  <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
  <div class="add-user-card">
    <h3><i class="fas fa-user-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h3>

    <div class="add-user-grid">
      <input type="text" id="new-user-firstname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á" />
      <input type="text" id="new-user-lastname" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
      <input type="email" id="new-user-email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö)" />
      <input type="number" id="new-user-phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" />
      <input type="password"id="new-user-password"placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" />

      <select id="new-user-role">
        <option value="tech">‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏°</option>
        <option value="staff">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</option>
        <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
      </select>

      <button type="button" class="btn-add-user" id="btn-add-user">
        <i class="fas fa-user-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      </button>
    </div>

    <p class="hint-text">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    </p>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
  <div class="table-wrapper">
  <table class="styled-table users-table" id="admin-users-table">
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
        <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
        <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
        <th class="center">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
        <th class="center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th class="center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

  <div id="users-empty" class="empty-text" style="display:none;">
    <i class="fas fa-user-slash"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
  </div>
</div>

<script>
/* ==================================================
   CONFIG
================================================== */
const API_BASE = "/api";
const token    = localStorage.getItem("token");
const role     = localStorage.getItem("role");
const userId   = localStorage.getItem("userId");
const userName = localStorage.getItem("userName");

/* ==================================================
   AUTH GUARD
================================================== */
if (!token || role !== "admin") {
  alert("‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
  localStorage.clear();
  location.href = "login.html";
}

/* ==================================================
   SAFE SET
================================================== */
function safeSet(id, value) {
  const el = document.getElementById(id);
  if (el) el.textContent = value;
}

safeSet("user-meta", `${userName || "Admin"} (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)`);

/* ==================================================
   API FETCH
================================================== */
async function apiFetch(path, options = {}) {
  const res = await fetch(API_BASE + path, {
    headers: {
      Authorization: `Bearer ${token}`,
      ...(options.body ? {} : { "Content-Type": "application/json" })
    },
    ...options
  });

  if (res.status === 401 || res.status === 403) {
    alert("Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏");
    localStorage.clear();
    location.href = "login.html";
    return null;
  }

  return res.ok ? res.json() : null;
}

/* ==================================================
   LOAD PROFILE
================================================== */
async function loadProfile() {
  if (!userId) return;

  const user = await apiFetch(`/employees/${userId}/profile`);
  if (!user) return;

  const avatar = user.avatar || "/uploads/profile/default.jpg";

  const img1 = document.getElementById("profileAvatar");
  const img2 = document.getElementById("profileAvatarLarge");

  if (img1) img1.src = avatar;
  if (img2) img2.src = avatar;

  localStorage.setItem("avatar", avatar);
}

/* ==================================================
   LOAD DATA
================================================== */
async function loadJobs() {
  return (await apiFetch("/jobs")) || [];
}

async function loadUsers() {
  return (await apiFetch("/employees")) || [];
}

/* ==================================================
   UPDATE DASHBOARD CARDS
================================================== */
function updateCards(jobs, users) {
  safeSet("card-total-jobs", jobs.length);
  safeSet("card-new-jobs", jobs.filter(j => j.status === "‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á").length);
  safeSet(
    "card-progress-jobs",
    jobs.filter(j => ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°", "‡∏£‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà"].includes(j.status)).length
  );
  safeSet("card-completed-jobs", jobs.filter(j => j.status === "‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à").length);
  safeSet("card-users-count", users.length);
}

/* ==================================================
   RENDER JOBS TABLE
================================================== */
function renderJobsTable(jobs) {
  const tbody = document.querySelector("#admin-jobs-table tbody");
  if (!tbody) return;

  tbody.innerHTML = "";

  if (!jobs.length) {
    tbody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align:center;color:#6b7280;">
          ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°
        </td>
      </tr>
    `;
    return;
  }

  jobs.slice(0, 10).forEach(j => {
    let statusClass = "status-new";
    if (j.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°") statusClass = "status-in_progress";
    else if (j.status === "‡∏£‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà") statusClass = "status-waiting_parts";
    else if (j.status === "‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à") statusClass = "status-completed";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${j.receiptNumber || "-"}</td>

      <td>
        <strong>${j.customerName || "-"}</strong>
      </td>

      <td>
        ${j.deviceType || ""} ${j.deviceModel || ""}
      </td>

      <td style="text-align:center;">
        <span class="status-badge ${statusClass}">
          ${j.status}
        </span>
      </td>

      <td style="text-align:center;">
        ${j.assignedTo?.firstName || "-"}
      </td>

      <td style="text-align:center;">
        ${
          j.receivedDate
            ? new Date(j.receivedDate).toLocaleDateString("th-TH")
            : "-"
        }
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* ==================================================
   RENDER USERS TABLE
================================================== */
function renderUsersTable(users) {
  const tbody = document.querySelector("#admin-users-table tbody");



  tbody.innerHTML = "";


  if (!users.length) {
    tbody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align:center;color:#6b7280;">
          ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        </td>
      </tr>
    `;
    return;
  }


  users.forEach(u => {
    const statusHtml = u.online
      ? `<span class="status-online">‚óè ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>`
      : `<span class="status-offline">‚óè ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>`;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.firstName} ${u.lastName}</td>
      <td>${u.email}</td>
      <td>${u.phone || "-"}</td>

      <td>
        <select onchange="updateUserRole('${u._id}', this.value)">
          <option value="admin" ${u.role==="admin"?"selected":""}>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
          <option value="staff" ${u.role==="staff"?"selected":""}>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
          <option value="tech"  ${u.role==="tech" ?"selected":""}>‡∏ä‡πà‡∏≤‡∏á</option>
        </select>
      </td>

      <td>${statusHtml}</td>

      <td>
        <button class="btn-edit" onclick="editUser('${u._id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn-delete" onclick="deleteUser('${u._id}')">‡∏•‡∏ö</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function editUser(id) {
  window.location.href = `edit_user.html?id=${id}`;
}
/* ==================================================
   UPDATE USER ROLE
================================================== */
async function updateUserRole(id, role) {
  if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;

  const res = await apiFetch(`/employees/${id}`, {
    method: "PUT",
    body: JSON.stringify({ role })
  });

  if (res) {
    alert("‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    init();
  }
}

/* ==================================================
   DELETE USER
================================================== */
async function deleteUser(id) {
  if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;

  const res = await apiFetch(`/employees/${id}`, { method: "DELETE" });
  if (res) {
    alert("‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    init();
  }
}

/* ==================================================
   AVATAR UPLOAD
================================================== */
async function uploadAvatar(event) {
  const file = event.target.files[0];
  if (!file) return;

  const fd = new FormData();
  fd.append("avatar", file);

  const res = await fetch("/api/employees/profile/avatar", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`
    },
    body: fd
  });

  const data = await res.json();

  if (!res.ok) {
    alert(data.message || "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    return;
  }

  document.getElementById("profileAvatar").src = data.avatar;
  document.getElementById("profileAvatarLarge").src = data.avatar;

  localStorage.setItem("avatar", data.avatar);
  alert("‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}

/* ==================================================
   INIT
================================================== */
async function init() {
  const [jobs, users] = await Promise.all([
    loadJobs(),
    loadUsers()
  ]);

  updateCards(jobs, users);
  renderJobsTable(jobs);
  renderUsersTable(users);
}

/* ==================================================
   LOGOUT
================================================== */
async function logout() {
  await fetch("/api/auth/logout", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${localStorage.getItem("token")}`
    }
  });

  localStorage.clear();
  location.href = "login.html";
}

/* ==================================================
   ON LOAD
================================================== */
document.addEventListener("DOMContentLoaded", () => {
  loadProfile();
  init();
});
document.getElementById("btn-add-user")?.addEventListener("click", async () => {
  const firstName = document.getElementById("new-user-firstname").value.trim();
  const lastName  = document.getElementById("new-user-lastname").value.trim();
  const email     = document.getElementById("new-user-email").value.trim();
  const password  = document.getElementById("new-user-password").value.trim();
  const role      = document.getElementById("new-user-role").value;

  if (!firstName || !lastName || !email || !password || !role) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  const res = await fetch("/api/employees", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({
      firstName,
      lastName,
      email,
      password,
      role
    })
  });

  const data = await res.json();

  if (!res.ok) {
    alert(data.message || "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    return;
  }

  alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");

  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
  document.getElementById("new-user-firstname").value = "";
  document.getElementById("new-user-lastname").value = "";
  document.getElementById("new-user-email").value = "";
  document.getElementById("new-user-password").value = "";

  // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
  init();
});
function toggleProfile() {
  const dropdown = document.getElementById("profileDropdown");
  dropdown.classList.toggle("show");
}

document.addEventListener("click", (e) => {
  const trigger = document.querySelector(".profile-trigger");
  const dropdown = document.getElementById("profileDropdown");

  if (!trigger || !dropdown) return;

  if (!trigger.contains(e.target) && !dropdown.contains(e.target)) {
    dropdown.classList.remove("show");
  }
});
document.addEventListener("DOMContentLoaded", () => {
  const role = localStorage.getItem("role");
  const adminTab = document.getElementById("adminTab");

  if (adminTab && role !== "admin") {
    adminTab.remove(); // üî• ‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà display:none
  }
});

</script>


</body>
</html>

